name: train_pytorch_bert
description: Train PyTorch Bert

inputs:
    - {name: TrainingData, type: String, description: 'Path to the training data'}
    - {name: MaxEpochs, type: Integer, description: 'Maximum number of epochs'}
    - {name: NumSamples, type: Integer, description: 'Maximum number of samples'}
    - {name: BatchSize, type: Integer, description: 'Batch size'}
    - {name: NumWorkers, type: Integer, description: 'Number of workers'}
    - {name: LearningRate, type: Float, description: 'Learning rate'}
    - {name: Accelerator, type: String, description: 'multi gpu training'}
    - {name: BucketName, type: String, description: 'S3 bucket name'}
    - {name: FolderName, type: String, description: 'S3 folder'}

outputs:
    - {name: ModelCheckpoint, type: Directory, description: "Path for the resulting model checkpoint"}
    - {name: TensorboardLogs, type: String, description: "Path for the tensorboard logs"}
    - {name: TensorboardS3Path, type: String, description: "Tensorboard S3 Path"}

implementation:
    container:
        image: __IMAGE_NAME__
        command: ["python","/component/entry_point.py"]
        args: [
            --train_glob, {inputPath: TrainingData},
            --model_save_path, {outputPath: ModelCheckpoint},
            --tensorboard_root, {outputPath: TensorboardLogs},
            --max_epochs, {inputValue: MaxEpochs},
            --num_samples, {inputValue: NumSamples},
            --batch_size, {inputValue: BatchSize},
            --num_workers, {inputValue: NumWorkers},
            --learning_rate, {inputValue: LearningRate},
            --accelerator, {inputValue: Accelerator},
            --bucket_name, {inputValue: BucketName},
            --folder_name, {inputValue: FolderName}
        ]
        fileOutputs: 
            TensorboardS3Path: /logdir.txt
